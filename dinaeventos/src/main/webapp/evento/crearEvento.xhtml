<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect TexAlCenter">
		<h:form id="eventoForm" enctype="multipart/form-data">
			<p:growl id="growl" sticky="false" showDetail="true" life="5000" />
			<div class="ui-fluid">
				<p:outputPanel  width="100%">
					<h2 style="margin-top:0">1 DETALLES DEL EVENTO</h2>
					<h3 style="margin-top:0">NOMBRE DEL EVENTO</h3>
					<p:inputText id="eventoNombre" maxLength="75" required="true" value="#{evento.evento.nombre}" placeholder="Coloca un nombre increible"/>
					<p:message for="eventoNombre" styleClass="error"/>
					
					<h3 style="margin-top:0">UBICACIÓN</h3>
					<p:inputText id="eventoDireccion1" value="#{evento.evento.direccion}" placeholder="Dirección"/>
					
					<p:inputText id="eventoCodigoPostal" value="#{evento.evento.codigoPostal.codigo}" maxlength="5" placeholder="Código postal">
						<p:ajax event="blur" update="eventoProvincia" listener="#{evento.actualizaLocalidadesByCP(evento.evento.codigoPostal.codigo)}" />
					</p:inputText>
					<p:selectOneMenu id="eventoProvincia" value="#{evento.evento.idcodigopostal}">
						<f:selectItem itemValue="#{null}" itemLabel="Seleccionar localidad" />
						<f:selectItems value="#{evento.codigosPostales}" var="cp" itemLabel="#{cp.localidad} - #{cp.provincia.nombre}" itemValue="#{cp.idcodigopostal}" />
					</p:selectOneMenu>
					
					<h3 style="margin-top:0">EMPIEZA</h3>
					<p:calendar id="eventoFechaHoraInicio" value="#{evento.evento.fechaIni}" pattern="MM/dd/yyyy HH:mm:ss" />
 
					<h3 style="margin-top:0">FINALIZA</h3>
					<p:calendar id="eventoFechaHoraFin" value="#{evento.evento.fechaFin}" pattern="MM/dd/yyyy HH:mm:ss" />
					
					<h3 style="margin-top:0">LOGO DEL EVENTO</h3>
					<p:fileUpload id="eventoImageUpload" update=":eventoForm:eventoImageUpload, :eventoForm:growl" auto="true" label="Seleccionar Logo" sizeLimit="1000000" fileLimit="1" fileUploadListener="#{evento.handleFileUploadLogoEvento}" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>
					<p:message for="eventoImageUpload" />
					
					<h3 style="margin-top:0">TIPO DE EVENTO</h3>
					<p:selectOneMenu id="eventoTipoEvento" value="#{evento.evento.idtipoevento}" >
            			<f:selectItem itemLabel="Tipo de Evento" itemValue="" />
            			<f:selectItems value="#{evento.ddTipoEvento}" var="tipoEvento" itemLabel="#{tipoEvento.tipoEvento}" itemValue="#{tipoEvento.idTipoEvento}" />
        			</p:selectOneMenu>
					
					<h3 style="margin-top:0">DESCRIPCIÓN DEL EVENTO</h3>
					<p:editor id="eventoDescripcion" widgetVar="eventoDescripcionWidget" value="#{evento.evento.descripcion}" />
					
					<h3 style="margin-top:0">ORGANIZADOR</h3>
					<p:inputText value="#{evento.evento.organizador.nombre}" placeholder="¿Quién organiza este evento?"/>
					<h3 style="margin-top:0">DESCRIPCIÓN DEL ORGANIZADOR</h3>
					<p:editor value="#{evento.evento.organizador.descripcion}" />
					<p:spacer height="0"/>
					<p:panel id="eventoPanelListaPatrocinadores" header="Patrocinadores">
						<p:dataList id="eventoListaPatrocinadores" value="#{evento.evento.patrocinadores}" var="patrocinador" type="unordered" emptyMessage="Agrega un Patrocinador" itemType="none" rows="2">
					       #{patrocinador.nombre}
					       <f:facet name="description">
					           <p:graphicImage value="evento.obtenerImagen(#{patrocinador.fotoNombre}, #{patrocinador.fotoperfil})"/> 
					       </f:facet>
						</p:dataList>
						<f:facet name="actions">
				   			<p:commandLink onclick="PF('patrocinadorDialogo').show()" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText styleClass="ui-icon ui-icon-plus" /></p:commandLink>
				   		</f:facet>
					</p:panel>
					<p:spacer height="0"/>
					
					<h2 style="margin-top:20px">2. ENTRADAS</h2>
					<h3 style="margin-top:0">AFORO DEL EVENTO</h3>
					<p:inputText id="eventoAforo" value="#{evento.evento.aforo}" placeholder="Aforo"/>
					<p:panel id="eventoEntradaPanel" header="Crea Entradas" style="margin-top:20px">
						<p:dataList id="eventoListaEntrada" value="#{evento.evento.ddTipoEntradas}" var="tipoEntrada" type="unordered" emptyMessage="Agrega un Tipo de Entrada" itemType="none" >
					       #{tipoEntrada.nombre} #{tipoEntrada.precio} #{tipoEntrada.cantidad} #{tipoEntrada.sobreVenta} #{tipoEntrada.maxPorPedido} #{tipoEntrada.canalDeVentas} #{tipoEntrada.fechaInicioVenta} #{tipoEntrada.fechaFinVenta}
						</p:dataList>
				        <f:facet name="footer">
				        	<p:spacer height="0"/>
				        	<p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank">
								<p:inputText id="eventoEntradaNombre" maxLength="100" value="#{evento.tipoEntrada.nombre}" placeholder="Compra Anticapada, VIP..."/>
								<p:inputText id="eventoEntradaCantidad" maxLength="6" value="#{evento.tipoEntrada.cantidad}" placeholder="100"/>
								<h:outputText value="SobreVenta: " />
								<p:selectBooleanCheckbox value="#{evento.tipoEntrada.sobreVenta}" />
								<p:selectOneMenu id="eventoEntradaCanalDeVenta" value="#{evento.tipoEntrada.canalDeVentas}" style="width:125px">
						            <f:selectItem itemLabel="Selecionar Uno" itemValue="" />
						            <f:selectItem itemLabel="online" itemValue="online" />
						            <f:selectItem itemLabel="papel" itemValue="papel" />
						        </p:selectOneMenu>
						        <p:calendar id="eventoEntradaFechaInicioVenta" value="#{evento.tipoEntrada.fechaInicioVenta}" pattern="MM/dd/yyyy" placeholder="Inicio de la venta de entradas"/>
						        <p:calendar id="eventoEntradaFechaFinVenta" value="#{evento.tipoEntrada.fechaFinVenta}" pattern="MM/dd/yyyy" placeholder="Fin de la venta de entradas"/>
						        <p:inputNumber id="eventoEntradaMaxPorTransaccion" value="#{evento.tipoEntrada.maxPorPedido}" minValue="1" maxValue="100" placeholder="Entradas permitidas por pedido"/>  
								<p:inputNumber id="eventoEntradaPrecio" value="#{evento.tipoEntrada.precio}" symbol=" €" symbolPosition="s" decimalSeparator="," thousandSeparator="." placeholder="15,00"/>
							<p:spacer height="0"/>
							</p:panelGrid>
							<p:commandButton value="Agregar Entrada" actionListener="#{evento.crearTipoEntrada}" process="eventoEntradaPanel"  update="eventoEntradaPanel" />				        	
	            		</f:facet>
			    	</p:panel>
					<p:panel id="eventoComplementoPanel" header="Complementos" style="margin-top:20px">
				        <p:panelGrid columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid" styleClass="ui-panelgrid-blank">
				            <p:graphicImage name="demo/images/godfather/godfather1.jpg" />
				            <h:outputText
				                value="The story begins as Don Vito Corleone, the head of a New York Mafia family, oversees his daughter's wedding. 
				                His beloved son Michael has just come home from the war, but does not intend to become part of his father's business.
				                Through Michael's life the nature of the family business becomes clear. The business of the family is just like the head of the family, kind and benevolent to those who give respect, 
				                but given to ruthless violence whenever anything stands against the good of the family." />
				        </p:panelGrid>
				        <p:panelGrid columns="3" layout="grid" styleClass="ui-panelgrid-blank">
							<p:inputText id="eventoComplementoNombre" maxLength="100" value="#{evento.complemento.nombre}" placeholder="Cerveza, papas, pulsera..."/>
							<p:inputText id="eventoComplementoDescripcion" value="#{evento.complemento.descripcion}" placeholder="Breve Descripción"/>
							<p:inputNumber id="eventoComplementoPrecio" value="#{evento.complemento.precio}" symbol=" €" symbolPosition="s" decimalSeparator="," thousandSeparator="." placeholder="15,00"/>
						</p:panelGrid>
							<p:fileUpload id="eventoComplementoImagenUpload" update="eventoComplementoImagenUpload, :eventoForm:growl" label="Seleccionar Imagen" uploadLabel="Subir" cancelLabel="Cancelar" sizeLimit="1000000" fileLimit="1" fileUploadListener="#{evento.handleFileUploadComplementoImagen}" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>
							<p:message for="eventoComplementoImagenUpload" />
				        <f:facet name="footer">
	                		<p:commandButton value="Crear Complemento" action="#{evento.crearComplemento}" process="eventoComplementoPanel" update="eventoComplementoPanel"/>
	            		</f:facet>
			    	</p:panel>
			    	
			    	<p:panel header="Imagen Prueba3" style="margin-bottom:20px">
			    		<p:graphicImage value="#{evento.obtenerImagenPrueba()}"/>
			    		<p:graphicImage value="#{loginBean.obtenerImagenPrueba()}"/>
			    	</p:panel>
			    	
					<p:commandButton value="Crear Evento" action="#{evento.crearEvento}" />
				</p:outputPanel>
			</div>
		</h:form>
		</div>
            </div>
        </div>
		<p:dialog header="Patrocinador" widgetVar="patrocinadorDialogo" resizable="false" modal="true">
			<h:form id="eventoPatrocinadorDialogo" enctype="multipart/form-data">
		        <div class="ui-fluid">
		        	<p:growl id="patrocinadorGrowl" sticky="false" showDetail="true" life="5000" />
	    			<p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank">
			            <p:outputLabel for="eventoNombrePatrocinador" value="Nombre: " />
			            <p:inputText id="eventoNombrePatrocinador" value="#{evento.patrocinador.nombre}" required="true" label="patrocinador"/>
					</p:panelGrid>
					<p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank">
						<p:fileUpload id="eventoImagePatrocinadorUpload" fileUploadListener="#{evento.handleFileUploadPatrocinador}" auto="true" label="Seleccionar Logo" sizeLimit="1000000" fileLimit="1" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
						
			            <f:facet name="footer">
			                <p:commandButton value="Crear Patrocinador" actionListener="#{evento.crearPatrocinador}" oncomplete="handlePatrocinadorRequest(xhr, status, args)" update=":eventoForm:eventoListaPatrocinadores, :eventoForm:eventoPanelListaPatrocinadores, :eventoPatrocinadorDialogo, :eventoPatrocinadorDialogo:patrocinadorGrowl"/>
			            </f:facet>  
		        	</p:panelGrid>
		        </div>
	        </h:form>
    	</p:dialog>
	<script type="text/javascript">
	    function handlePatrocinadorRequest(xhr, status, args) {
	        if(args.validationFailed || !args.patrocinadorCreado) {
	            PF('patrocinadorDialogo').jq.effect("shake", {times:5}, 100);
	        }
	        else {
	        	PF('patrocinadorDialogo').hide()
	            $('#loginLink').fadeOut();
	        }
	    }
	</script>
	
        
    </ui:define>

</ui:composition>