<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/resources/scaffold/pageTemplateCliente.xhtml"
	xmlns:p="http://primefaces.org/ui">

	
	<script type="text/javascript" src="js/waitbutton.js"></script> 
	
	<script type="text/javascript"> var WaitButton=WaitButton||(function(){var a=true;var b;return{init:function(f,e,c){b=document.createElement("div");b.setAttribute("id","textDiv");b.className="waitButton";b.style.display="none";if(c===undefined||c==""){b.innerHTML=e;}else{b.innerHTML=e+" <img height='20px' src='"+c+"' />";}var d=document.getElementById(f);
	if(d){d.parentNode.insertBefore(b,d);}},noWaitButton:function(){a=false;},forceUseWaitButton:function(){a=true;},showWaitButton:function(){if(a==true){b.style.display="inline";return true;}else{return false;}}};}());
	</script>
	
	<script type="text/javascript">WaitButton.init('botonComprar', 'Procesando pago...', 'images/wait3.gif')</script>
		
		
		


	<ui:param name="pageTitle" value="Compra entradas"/>

	<ui:define name="header">
		<h1>Entrada</h1>
	</ui:define>

	<ui:define name="subheader">
		<h3>Añade un complemento</h3>
	</ui:define>

	<ui:define name="footer"/>

	<ui:define name="main">
	
		<h:form id="comprar">
		
 
		<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
    		<p:graphicImage name="images/wait3.gif" />
		</p:dialog>
				
				
				<p:repeat var="entrada"  value="#{ddTipoComplementoBean.listadoEntradas}" >
					
					  <div class="col-sm-6 col-md-6">
					    <div class="thumbnail">
					    <div class="section">
		        			<div class="container" style="width: 100%">
							      <div class="col-md-4 ">
							        <h3>#{entrada.nombre}</h3>
							        <p>#{entrada.usuario.nombre}</p>
							        <p>Precio: #{entrada.precio}€</p>
							      </div>
							   
							       <div class="col-md-8" >
							       <p:repeat var="comple"  value="#{entrada.listaComplementos}" > 
								       <table class="table">
								       <tbody>
									       	<tr>
										       <td><h:outputLabel value="#{comple.complemento.nombre}" /></td>
										       <td><h:outputLabel value="#{comple.complemento.precio}" /></td>
										       <td> <h:outputLabel value="#{comple.complemento.descripcion}" /></td>
										        <td><p:spinner size="3"  value="#{comple.cantidad}" min="0" > 
										       	<p:ajax  update="comprar:totales" listener="#{ddTipoComplementoBean.agregarComplemento}" />
										       </p:spinner></td>
										    </tr>
									    </tbody>
								       </table>
							        </p:repeat>
							        </div>
							 </div>
						</div>
					</div>
				</div>	
			</p:repeat>
				
				
					<p:outputPanel id="totales" >
			        			<div class="col-md-12 ">
							<p:outputLabel  value="Total: " /> <p:outputLabel id="total" value="#{ddTipoComplementoBean.total} €"></p:outputLabel>
								</div>
								<div class="col-md-12">
									<h:outputText value="Enviar cada entrada a cada amigo: " />
        							<p:inputSwitch id="value1" value="#{ddTipoComplementoBean.envioConjunto}" />
        						</div>
								<div class="col-md-12 ">
									<p:repeat var="entrada" value="#{ddTipoComplementoBean.listadoEntradas}" >
										<p:outputPanel rendered="#{!empty entrada.listaComplementos}">
										<p:outputLabel  value="#{entrada.usuario.nombre} " /> 
										<p:outputLabel  value=" va ha comprar:" /> 
										<p:repeat var="complemento" value="#{entrada.listaComplementos}"  >
											<p:outputPanel rendered="#{complemento.cantidad > 0}">
											
											<p:outputLabel  value="Cantidad #{complemento.cantidad} de" /> <p:outputLabel  value=" #{complemento.complemento.nombre} " /> <p:outputLabel  value=" precio: #{complemento.complemento.precio}" /> 	 
											</p:outputPanel>
										</p:repeat>
										</p:outputPanel>
									</p:repeat>
								</div>
								<div class="col-md-12">
								
								
								
								</div>
								
					</p:outputPanel>
					<br></br>
					<br></br>
					<p:separator />
					
					<p:outputPanel style="margin:auto; width:20%;">
						<p:commandLink styleClass="btn btn-primary" id="botonComprar"  action="#{ddTipoComplementoBean.cambiarPagina()}" value="Finalizar compra" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
						</p:commandLink>
					</p:outputPanel>
		</h:form>		
	</ui:define>

</ui:composition>
